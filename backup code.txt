# ë²„ì „: 1.0.0
# ì‘ì„±ì: Levi Beak
# ìµœì¢… ìˆ˜ì •ì¼: 2025-02-04

import pandas as pd
import glob
import os
import sqlite3
import tkinter as tk
from tkinter import filedialog, ttk, messagebox, simpledialog
import matplotlib.pyplot as plt
from matplotlib.backends.backend_tkagg import FigureCanvasTkAgg
from datetime import datetime
import sys

class DBManager:
    def __init__(self):
        self.window = tk.Tk()
        self.window.title("DB ê´€ë¦¬ í”„ë¡œê·¸ë¨")
        self.window.geometry("1300x800")
        
        # ì‹¤í–‰ íŒŒì¼ê³¼ ê°œë°œ í™˜ê²½ ëª¨ë‘ì—ì„œ ì‘ë™í•˜ë„ë¡ ê²½ë¡œ ì²˜ë¦¬
        try:
            if getattr(sys, 'frozen', False):
                # ì‹¤í–‰ íŒŒì¼ë¡œ ì‹¤í–‰ë  ë•Œì˜ ê²½ë¡œ
                application_path = sys._MEIPASS
            else:
                # ì¼ë°˜ Python ìŠ¤í¬ë¦½íŠ¸ë¡œ ì‹¤í–‰ë  ë•Œì˜ ê²½ë¡œ
                application_path = os.path.dirname(os.path.abspath(__file__))
            
            icon_path = os.path.join(application_path, "resources", "icons", "db_compare.ico")
            self.window.iconbitmap(icon_path)
        except Exception as e:
            print(f"ì•„ì´ì½˜ ë¡œë“œ ì‹¤íŒ¨: {str(e)}")
        
        # Maintenance Mode ìƒíƒœ ë³€ìˆ˜
        self.maint_mode = False
        self.default_password = "1234"  # ì‹¤ì œ ë°°í¬ì‹œì—ëŠ” ë” ì•ˆì „í•œ ë°©ì‹ìœ¼ë¡œ ê´€ë¦¬
        
        # ë©”ë‰´ë°” ìƒì„±
        self.create_menu()
        
        # ë‹¨ì¶•í‚¤ ë°”ì¸ë”©
        self.window.bind('<F1>', lambda event: self.show_user_guide())
        self.window.bind('<Control-o>', lambda event: self.load_folder())
        self.window.bind('<Control-O>', lambda event: self.load_folder())
        
        # ìƒíƒœ í‘œì‹œì¤„ ìƒì„±
        self.status_bar = ttk.Label(self.window, relief=tk.SUNKEN, anchor=tk.W)
        self.status_bar.pack(side=tk.BOTTOM, fill=tk.X)
        
        # ê¸°ë³¸ UI êµ¬ì„±
        self.main_notebook = ttk.Notebook(self.window)
        self.main_notebook.pack(expand=True, fill=tk.BOTH)
        
        # ë¹„êµ ë…¸íŠ¸ë¶ ìƒì„±
        self.comparison_notebook = ttk.Notebook(self.main_notebook)
        self.main_notebook.add(self.comparison_notebook, text="DB ë¹„êµ")
        
        # ì´ˆê¸° ìƒíƒœ ì„¤ì •
        self.file_names = []
        self.folder_path = ""
        self.merged_df = None
        
        # DB ë¹„êµ ê´€ë ¨ íƒ­ ìƒì„±
        self.create_comparison_tabs()

    def create_menu(self):
        menubar = tk.Menu(self.window)
        self.window.config(menu=menubar)
        
        # íŒŒì¼ ë©”ë‰´
        file_menu = tk.Menu(menubar, tearoff=0)
        menubar.add_cascade(label="íŒŒì¼", menu=file_menu)
        file_menu.add_command(label="í´ë” ì—´ê¸° (Ctrl+O)", command=self.load_folder)
        file_menu.add_separator()
        file_menu.add_command(label="ì¢…ë£Œ", command=self.window.quit)
        
        # ë„ì›€ë§ ë©”ë‰´
        help_menu = tk.Menu(menubar, tearoff=0)
        menubar.add_cascade(label="ë„ì›€ë§", menu=help_menu)
        help_menu.add_command(label="ì‚¬ìš© ì„¤ëª…ì„œ (F1)", command=self.show_user_guide)
        help_menu.add_separator()
        help_menu.add_command(label="í”„ë¡œê·¸ë¨ ì •ë³´", command=self.show_about)

    def toggle_maint_mode(self):
        # ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ì°½
        password = simpledialog.askstring("Maintenance Mode", 
                                        "ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:",
                                        show='*')
        
        if password == self.default_password:
            self.maint_mode = not self.maint_mode
            if self.maint_mode:
                self.enable_maint_features()
                messagebox.showinfo("ì•Œë¦¼", "Maintenance Modeê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.")
            else:
                self.disable_maint_features()
                messagebox.showinfo("ì•Œë¦¼", "Maintenance Modeê°€ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.")
        else:
            messagebox.showerror("ì˜¤ë¥˜", "ì˜ëª»ëœ ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤.")

    def enable_maint_features(self):
        # QC ê²€ìˆ˜ íƒ­ ì¶”ê°€
        self.create_qc_tab()
        
    def disable_maint_features(self):
        # QC ê²€ìˆ˜ íƒ­ ì œê±°
        for tab in self.main_notebook.tabs():
            tab_text = self.main_notebook.tab(tab, "text")
            if tab_text == "QC ê²€ìˆ˜":
                self.main_notebook.forget(tab)

    def create_qc_tab(self):
        # QC ê²€ìˆ˜ íƒ­ì´ ì—†ì„ ë•Œë§Œ ìƒì„±
        if not any(self.main_notebook.tab(tab, "text") == "QC ê²€ìˆ˜" 
                  for tab in self.main_notebook.tabs()):
            qc_tab = ttk.Frame(self.main_notebook)
            self.main_notebook.add(qc_tab, text="QC ê²€ìˆ˜")
            
            # QC ê²€ìˆ˜ íƒ­ ë‚´ìš© êµ¬ì„±
            qc_label = ttk.Label(qc_tab, text="QC ê²€ìˆ˜ ê¸°ëŠ¥ - ê°œë°œ ì¤‘")
            qc_label.pack(pady=20)

    def create_comparison_tabs(self):
        """ë¹„êµ ê´€ë ¨ íƒ­ ìƒì„±"""
        # ê²©ì ë·° íƒ­ ìƒì„±
        self.create_grid_view_tab()
        # DB ê°’ ë¹„êµ íƒ­ ìƒì„±
        self.create_comparison_tab()
        # ë‹¤ë¥¸ ê°’ë§Œ ë³´ê¸° íƒ­ ìƒì„±
        self.create_diff_only_tab()
        # ë³´ê³ ì„œ íƒ­ ìƒì„±
        self.create_report_tab()

    def load_folder(self):
        # íŒŒì¼ í™•ì¥ì í•„í„° ì„¤ì •
        filetypes = [
            ("DB íŒŒì¼", "*.txt;*.db;*.csv"),
            ("í…ìŠ¤íŠ¸ íŒŒì¼", "*.txt"),
            ("CSV íŒŒì¼", "*.csv"),
            ("DB íŒŒì¼", "*.db"),
            ("ëª¨ë“  íŒŒì¼", "*.*")
        ]
        
        # íŒŒì¼ ì„ íƒ ë‹¤ì´ì–¼ë¡œê·¸
        files = filedialog.askopenfilenames(
            title="ğŸ“‚ DB íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”",
            filetypes=filetypes,
            initialdir=self.folder_path if self.folder_path else None
        )
        
        if not files:
            self.status_bar.config(text="íŒŒì¼ ì„ íƒì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.")
            return

        # ë¡œë”© ë‹¤ì´ì–¼ë¡œê·¸ ìƒì„±
        loading_dialog = LoadingDialog(self.window)
        
        try:
            df_list = []
            self.file_names = []
            total_files = len(files)
            
            # ì´ˆê¸° ì§„í–‰ë¥  í‘œì‹œ
            loading_dialog.update_progress(0, "íŒŒì¼ ë¡œë”© ì¤€ë¹„ ì¤‘...")
            
            for idx, file in enumerate(files, 1):
                try:
                    # íŒŒì¼ ë¡œë”© ì§„í–‰ë¥  (0-70%)
                    progress = (idx / total_files) * 70
                    loading_dialog.update_progress(
                        progress,
                        f"íŒŒì¼ ë¡œë”© ì¤‘... ({idx}/{total_files})"
                    )
                    
                    file_name = os.path.basename(file)
                    base_name = os.path.splitext(file_name)[0]
                    ext = os.path.splitext(file_name)[1].lower()
                    
                    # íŒŒì¼ í˜•ì‹ì— ë”°ë¥¸ ë¡œë“œ
                    if ext == '.txt':
                        df = pd.read_csv(file, delimiter="\t", dtype=str)
                    elif ext == '.csv':
                        df = pd.read_csv(file, dtype=str)
                    elif ext == '.db':
                        conn = sqlite3.connect(file)
                        df = pd.read_sql("SELECT * FROM main_table", conn)
                        conn.close()
                    
                    df["Model"] = base_name
                    df_list.append(df)
                    self.file_names.append(base_name)
                    
                except Exception as e:
                    messagebox.showwarning(
                        "ê²½ê³ ", 
                        f"'{file_name}' íŒŒì¼ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:\n{str(e)}"
                    )
            
            if df_list:
                # ì„ íƒëœ íŒŒì¼ë“¤ì˜ í´ë” ê²½ë¡œ ì €ì¥
                self.folder_path = os.path.dirname(files[0])
                
                # ë°ì´í„°í”„ë ˆì„ ë³‘í•©
                loading_dialog.update_progress(75, "ë°ì´í„° ë³‘í•© ì¤‘...")
                self.merged_df = pd.concat(df_list, ignore_index=True)
                
                # UI ì—…ë°ì´íŠ¸
                loading_dialog.update_progress(85, "í™”ë©´ ì—…ë°ì´íŠ¸ ì¤‘...")
                self.update_all_tabs()
                
                loading_dialog.update_progress(100, "ì™„ë£Œ!")
                
                # ì™„ë£Œ ë©”ì‹œì§€
                loading_dialog.close()
                messagebox.showinfo(
                    "ë¡œë“œ ì™„ë£Œ",
                    f"ì´ {len(df_list)}ê°œì˜ DB íŒŒì¼ì„ ì„±ê³µì ìœ¼ë¡œ ë¡œë“œí–ˆìŠµë‹ˆë‹¤.\n"
                    f"â€¢ í´ë”: {self.folder_path}\n"
                    f"â€¢ íŒŒì¼: {', '.join(self.file_names)}"
                )
                
                # ìƒíƒœ í‘œì‹œì¤„ ì—…ë°ì´íŠ¸
                self.status_bar.config(
                    text=f"ì´ {len(df_list)}ê°œì˜ DB íŒŒì¼ì´ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤. "
                         f"(í´ë”: {os.path.basename(self.folder_path)})"
                )
            else:
                loading_dialog.close()
                messagebox.showerror("ì˜¤ë¥˜", "íŒŒì¼ì„ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
                self.status_bar.config(text="íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨")
                
        except Exception as e:
            loading_dialog.close()
            messagebox.showerror("ì˜¤ë¥˜", f"ì˜ˆê¸°ì¹˜ ì•Šì€ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:\n{str(e)}")

    def update_all_tabs(self):
        # ê¸°ì¡´ íƒ­ ì œê±°
        for tab in self.comparison_notebook.winfo_children():
            tab.destroy()
        
        # íƒ­ ë‹¤ì‹œ ìƒì„±
        self.create_comparison_tabs()

    def create_grid_view_tab(self):
        grid_frame = ttk.Frame(self.comparison_notebook)
        self.comparison_notebook.add(grid_frame, text="ğŸ“‘ ê²©ì ë·°")
        
        grid_frame.rowconfigure([0, 1, 2], weight=1)
        grid_frame.columnconfigure([0, 1], weight=1)
        
        max_columns = 2
        for idx, file_name in enumerate(self.file_names[:6]):
            row = idx // max_columns
            col = idx % max_columns
            
            frame = ttk.LabelFrame(grid_frame, text=f"ğŸ“Œ {file_name}")
            frame.grid(row=row, column=col, padx=5, pady=5, sticky="nsew")
            frame.rowconfigure(0, weight=1)
            frame.columnconfigure(0, weight=1)
            
            container = ttk.Frame(frame)
            container.pack(fill=tk.BOTH, expand=True)
            
            # íŠ¸ë¦¬ë·° ì¶”ê°€
            tree = ttk.Treeview(container)
            tree["columns"] = ("Module", "Part", "ItemName", "ItemValue")
            tree.heading("#0", text="êµ¬ì¡°", anchor="w")
            tree.heading("Module", text="Module", anchor="w")
            tree.heading("Part", text="Part", anchor="w")
            tree.heading("ItemName", text="Item Name", anchor="w")
            tree.heading("ItemValue", text="Item Value", anchor="w")
            
            # ìŠ¤í¬ë¡¤ë°” ì¶”ê°€
            v_scroll = ttk.Scrollbar(container, orient="vertical", command=tree.yview)
            h_scroll = ttk.Scrollbar(container, orient="horizontal", command=tree.xview)
            tree.configure(yscroll=v_scroll.set, xscroll=h_scroll.set)
            
            v_scroll.pack(side=tk.RIGHT, fill=tk.Y)
            h_scroll.pack(side=tk.BOTTOM, fill=tk.X)
            tree.pack(expand=True, fill=tk.BOTH)
            
            # ë°ì´í„° ì¶”ê°€
            if self.merged_df is not None:
                model_data = self.merged_df[self.merged_df["Model"] == file_name]
                for module in model_data["Module"].unique():
                    module_node = tree.insert("", "end", text=f"ğŸ“ {module}", open=False)
                    
                    module_data = model_data[model_data["Module"] == module]
                    for part in module_data["Part"].unique():
                        part_node = tree.insert(module_node, "end", text=f"ğŸ“‚ {part}", open=False)
                        
                        part_data = module_data[model_data["Part"] == part]
                        for _, row in part_data.iterrows():
                            item_name = row["ItemName"]
                            item_value = row["ItemValue"]
                            tree.insert(part_node, "end", text=item_name, 
                                      values=(module, part, item_name, item_value))

    def create_comparison_tab(self):
        comparison_frame = ttk.Frame(self.comparison_notebook)
        self.comparison_notebook.add(comparison_frame, text="DB ê°’ ë¹„êµ")
        
        # íŠ¸ë¦¬ë·° ìƒì„±
        self.comparison_tree = ttk.Treeview(comparison_frame)
        self.comparison_tree["columns"] = ["Module", "Part", "ItemName"] + self.file_names
        
        # ì»¬ëŸ¼ ì„¤ì •
        self.comparison_tree.heading("#0", text="", anchor="w")
        self.comparison_tree.column("#0", width=0, stretch=False)
        
        for col in ["Module", "Part", "ItemName"]:
            self.comparison_tree.heading(col, text=col, anchor="w")
            self.comparison_tree.column(col, width=100)
        
        for model in self.file_names:
            self.comparison_tree.heading(model, text=model, anchor="w")
            self.comparison_tree.column(model, width=150)
        
        # ìŠ¤í¬ë¡¤ë°” ì¶”ê°€
        v_scroll = ttk.Scrollbar(comparison_frame, orient="vertical", 
                                command=self.comparison_tree.yview)
        h_scroll = ttk.Scrollbar(comparison_frame, orient="horizontal", 
                                command=self.comparison_tree.xview)
        self.comparison_tree.configure(yscroll=v_scroll.set, xscroll=h_scroll.set)
        
        # ë ˆì´ì•„ì›ƒ
        v_scroll.pack(side=tk.RIGHT, fill=tk.Y)
        h_scroll.pack(side=tk.BOTTOM, fill=tk.X)
        self.comparison_tree.pack(expand=True, fill=tk.BOTH)
        
        # ë°ì´í„° í‘œì‹œ
        self.update_comparison_view()

    def update_comparison_view(self):
        # ê¸°ì¡´ í•­ëª© ì‚­ì œ
        for item in self.comparison_tree.get_children():
            self.comparison_tree.delete(item)
        
        if self.merged_df is not None:
            # ë°ì´í„° ë¹„êµ ë° í‘œì‹œ
            grouped = self.merged_df.groupby(["Module", "Part", "ItemName"])
            
            for (module, part, item_name), group in grouped:
                values = [module, part, item_name]
                
                # ê° ëª¨ë¸ì˜ ê°’ ì¶”ê°€
                for model in self.file_names:
                    model_value = group[group["Model"] == model]["ItemValue"].values
                    value = model_value[0] if len(model_value) > 0 else "-"
                    values.append(value)
                
                # ê°’ì´ ë‹¤ë¥¸ í•­ëª©ì€ íƒœê·¸ ì¶”ê°€
                model_values = values[3:]
                tags = ("different",) if len(set(model_values)) > 1 else ()
                
                # ëª¨ë“  í•­ëª© í‘œì‹œ
                self.comparison_tree.insert("", "end", values=values, tags=tags)
            
            # ë‹¤ë¥¸ ê°’ì„ ê°€ì§„ í–‰ í•˜ì´ë¼ì´íŠ¸
            self.comparison_tree.tag_configure("different", background="light yellow")

    def create_diff_only_tab(self):
        # ë‹¤ë¥¸ ê°’ë§Œ ë³´ê¸° íƒ­ ìƒì„±
        diff_frame = ttk.Frame(self.comparison_notebook)
        self.comparison_notebook.add(diff_frame, text="ë‹¤ë¥¸ ê°’ë§Œ ë³´ê¸°")
        
        # íŠ¸ë¦¬ë·° ìƒì„±
        self.diff_tree = ttk.Treeview(diff_frame)
        self.diff_tree["columns"] = ["Module", "Part", "ItemName"] + self.file_names
        
        # ì»¬ëŸ¼ ì„¤ì •
        self.diff_tree.heading("#0", text="", anchor="w")
        self.diff_tree.column("#0", width=0, stretch=False)
        
        for col in ["Module", "Part", "ItemName"]:
            self.diff_tree.heading(col, text=col, anchor="w")
            self.diff_tree.column(col, width=100)
        
        for model in self.file_names:
            self.diff_tree.heading(model, text=model, anchor="w")
            self.diff_tree.column(model, width=150)
        
        # ìŠ¤í¬ë¡¤ë°” ì¶”ê°€
        v_scroll = ttk.Scrollbar(diff_frame, orient="vertical", command=self.diff_tree.yview)
        h_scroll = ttk.Scrollbar(diff_frame, orient="horizontal", command=self.diff_tree.xview)
        self.diff_tree.configure(yscroll=v_scroll.set, xscroll=h_scroll.set)
        
        # ë ˆì´ì•„ì›ƒ
        v_scroll.pack(side=tk.RIGHT, fill=tk.Y)
        h_scroll.pack(side=tk.BOTTOM, fill=tk.X)
        self.diff_tree.pack(expand=True, fill=tk.BOTH)
        
        # ë°ì´í„° í‘œì‹œ
        self.update_diff_view()

    def update_diff_view(self):
        # ê¸°ì¡´ í•­ëª© ì‚­ì œ
        for item in self.diff_tree.get_children():
            self.diff_tree.delete(item)
        
        if self.merged_df is not None:
            # ë°ì´í„° ë¹„êµ ë° í‘œì‹œ
            grouped = self.merged_df.groupby(["Module", "Part", "ItemName"])
            
            for (module, part, item_name), group in grouped:
                values = [module, part, item_name]
                
                # ê° ëª¨ë¸ì˜ ê°’ ì¶”ê°€
                model_values = []
                for model in self.file_names:
                    model_value = group[group["Model"] == model]["ItemValue"].values
                    value = model_value[0] if len(model_value) > 0 else "-"
                    values.append(value)
                    model_values.append(value)
                
                # ê°’ì´ ë‹¤ë¥¸ í•­ëª©ë§Œ í‘œì‹œ
                if len(set(model_values)) > 1:
                    self.diff_tree.insert("", "end", values=values, tags=("different",))
        
            # ë‹¤ë¥¸ ê°’ì„ ê°€ì§„ í–‰ í•˜ì´ë¼ì´íŠ¸
            self.diff_tree.tag_configure("different", background="light yellow")

    def create_report_tab(self):
        # ë³´ê³ ì„œ íƒ­ ìƒì„±
        report_frame = ttk.Frame(self.comparison_notebook)
        self.comparison_notebook.add(report_frame, text="ğŸ“Š ë¹„êµ ë³´ê³ ì„œ")
        
        # í†µê³„ í”„ë ˆì„ê³¼ ì°¨íŠ¸ í”„ë ˆì„ì„ ë‚˜ë€íˆ ë°°ì¹˜
        stats_frame = ttk.LabelFrame(report_frame, text="ğŸ“ˆ ë¹„êµ í†µê³„")
        stats_frame.pack(side=tk.LEFT, fill=tk.BOTH, expand=True, padx=5, pady=5)
        
        chart_frame = ttk.LabelFrame(report_frame, text="ğŸ“Š ì‹œê°í™”")
        chart_frame.pack(side=tk.LEFT, fill=tk.BOTH, expand=True, padx=5, pady=5)
        
        if self.merged_df is not None:
            # í†µê³„ ì •ë³´ ê³„ì‚°
            stats = self.calculate_stats()
            
            # ì „ì²´ í†µê³„
            total_frame = ttk.LabelFrame(stats_frame, text="ì „ì²´ í†µê³„")
            total_frame.pack(fill=tk.X, padx=5, pady=5)
            ttk.Label(total_frame, 
                     text=f"ì´ {stats['total_diff']}ê°œ í•­ëª©ì—ì„œ ì°¨ì´ê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.",
                     font=('Arial', 10, 'bold')).pack(pady=5)
            
            # ëª¨ë“ˆë³„ í†µê³„
            module_frame = ttk.LabelFrame(stats_frame, text="ëª¨ë“ˆë³„ ì°¨ì´")
            module_frame.pack(fill=tk.X, padx=5, pady=5)
            
            # ëª¨ë“ˆë³„ íŠ¸ë¦¬ë·°
            module_tree = ttk.Treeview(module_frame, height=10)
            module_tree["columns"] = ["count"]
            module_tree.heading("#0", text="ëª¨ë“ˆ", anchor="w")
            module_tree.heading("count", text="ì°¨ì´ ê°œìˆ˜", anchor="w")
            module_tree.column("#0", width=200)
            module_tree.column("count", width=100)
            
            for module, count in sorted(stats['module_diff'].items(), key=lambda x: x[1], reverse=True):
                module_tree.insert("", "end", text=module, values=(count,))
            
            module_tree.pack(fill=tk.X, padx=5, pady=5)
            
            # íŒŒíŠ¸ë³„ í†µê³„
            part_frame = ttk.LabelFrame(stats_frame, text="ìƒì„¸ ê²½ë¡œë³„ ì°¨ì´")
            part_frame.pack(fill=tk.X, padx=5, pady=5)
            
            # íŒŒíŠ¸ë³„ íŠ¸ë¦¬ë·°
            part_tree = ttk.Treeview(part_frame, height=15)
            part_tree["columns"] = ["count"]
            part_tree.heading("#0", text="ê²½ë¡œ", anchor="w")
            part_tree.heading("count", text="ì°¨ì´ ê°œìˆ˜", anchor="w")
            part_tree.column("#0", width=200)
            part_tree.column("count", width=100)
            
            for part, count in sorted(stats['part_diff'].items(), key=lambda x: x[1], reverse=True):
                part_tree.insert("", "end", text=part, values=(count,))
            
            part_tree.pack(fill=tk.X, padx=5, pady=5)
            
            # ì°¨íŠ¸ ìƒì„±
            try:
                # í•œê¸€ í°íŠ¸ ì„¤ì •
                plt.rcParams['font.family'] = 'Malgun Gothic'
                
                # ê·¸ë˜í”„ ìƒì„±
                fig = plt.figure(figsize=(8, 10))
                
                # ëª¨ë“ˆë³„ ì°¨ì´ ê·¸ë˜í”„
                ax1 = fig.add_subplot(211)
                modules = list(stats['module_diff'].keys())
                counts = list(stats['module_diff'].values())
                bars1 = ax1.bar(range(len(modules)), counts)
                ax1.set_title('Module Differences')
                ax1.set_xticks(range(len(modules)))
                ax1.set_xticklabels(modules, rotation=45, ha='right')
                
                # ë§‰ëŒ€ ìœ„ì— ê°’ í‘œì‹œ
                for bar in bars1:
                    height = bar.get_height()
                    ax1.text(bar.get_x() + bar.get_width()/2., height,
                            f'{int(height)}',
                            ha='center', va='bottom')
                
                # íŒŒíŠ¸ë³„ ì°¨ì´ ê·¸ë˜í”„ (ìƒìœ„ 10ê°œë§Œ)
                ax2 = fig.add_subplot(212)
                parts = list(stats['part_diff'].keys())[:10]
                part_counts = list(stats['part_diff'].values())[:10]
                bars2 = ax2.bar(range(len(parts)), part_counts)
                ax2.set_title('Top 10 Path Differences')
                ax2.set_xticks(range(len(parts)))
                ax2.set_xticklabels(parts, rotation=45, ha='right')
                
                # ë§‰ëŒ€ ìœ„ì— ê°’ í‘œì‹œ
                for bar in bars2:
                    height = bar.get_height()
                    ax2.text(bar.get_x() + bar.get_width()/2., height,
                            f'{int(height)}',
                            ha='center', va='bottom')
                
                plt.tight_layout()
                
                # ìº”ë²„ìŠ¤ì— ê·¸ë˜í”„ í‘œì‹œ
                canvas = FigureCanvasTkAgg(fig, master=chart_frame)
                canvas.draw()
                canvas.get_tk_widget().pack(fill=tk.BOTH, expand=True)
                
            except Exception as e:
                error_msg = f"ì°¨íŠ¸ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {str(e)}"
                ttk.Label(chart_frame, text=error_msg, wraplength=300).pack(pady=20)
                print(error_msg)

    def calculate_stats(self):
        stats = {}
        grouped = self.merged_df.groupby(["Module", "Part", "ItemName"])
        
        # ëª¨ë“ˆë³„ ì°¨ì´ ê°œìˆ˜
        module_diff = {}
        # íŒŒíŠ¸ë³„ ì°¨ì´ ê°œìˆ˜
        part_diff = {}
        # ì „ì²´ ì°¨ì´ ê°œìˆ˜
        total_diff = 0
        
        for (module, part, item_name), group in grouped:
            values = [group[group["Model"] == model]["ItemValue"].values[0] 
                     if len(group[group["Model"] == model]["ItemValue"]) > 0 
                     else "-" for model in self.file_names]
            
            if len(set(values)) > 1:  # ê°’ì´ ë‹¤ë¥¸ ê²½ìš°
                total_diff += 1
                module_diff[module] = module_diff.get(module, 0) + 1
                part_key = f"{module} > {part}"
                part_diff[part_key] = part_diff.get(part_key, 0) + 1
        
        return {
            'total_diff': total_diff,
            'module_diff': module_diff,
            'part_diff': part_diff
        }

    def create_about_tab(self):
        # About íƒ­ ìƒì„±
        self.about_frame = ttk.Frame(self.main_notebook)
        self.main_notebook.add(self.about_frame, text="About")
        
        # ìŠ¤íƒ€ì¼ ì„¤ì •
        style = ttk.Style()
        style.configure("Title.TLabel", font=('Helvetica', 16, 'bold'))
        style.configure("Header.TLabel", font=('Helvetica', 12, 'bold'))
        style.configure("Content.TLabel", font=('Helvetica', 10))
        
        # ì»¨í…Œì´ë„ˆ í”„ë ˆì„
        container = ttk.Frame(self.about_frame, padding="20")
        container.pack(expand=True, fill=tk.BOTH)
        
        # í”„ë¡œê·¸ë¨ ì œëª©
        title_frame = ttk.Frame(container)
        title_frame.pack(fill=tk.X, pady=(0, 20))
        ttk.Label(title_frame, text="DB ê´€ë¦¬ í”„ë¡œê·¸ë¨", style="Title.TLabel").pack()
        
        # ì •ë³´ ì„¹ì…˜ë“¤
        sections = [
            ("Product Information", [
                ("Version", "1.0.0"),
                ("Release Date", "2025-02-04"),
            ]),
            ("Development", [
                ("Developer", "Levi Beak / ë°±ê´‘ë¦¼"),
                ("Organization", "Quality Assurance Team"),
                ("Contact", "levi.beak@parksystems.com"),
            ]),
                        ]
        
        for section_title, items in sections:
            # ì„¹ì…˜ í”„ë ˆì„
            section_frame = ttk.LabelFrame(container, text=section_title, padding="10")
            section_frame.pack(fill=tk.X, pady=(0, 10))
            
            # ê·¸ë¦¬ë“œ êµ¬ì„±
            for i, (key, value) in enumerate(items):
                ttk.Label(section_frame, text=key + ":", style="Header.TLabel").grid(
                    row=i, column=0, sticky="w", padx=(0, 10), pady=2)
                ttk.Label(section_frame, text=value, style="Content.TLabel").grid(
                    row=i, column=1, sticky="w", pady=2)
        
        # í”„ë¡œê·¸ë¨ ì„¤ëª…
        desc_frame = ttk.LabelFrame(container, text="Description", padding="10")
        desc_frame.pack(fill=tk.X, pady=(0, 10))
        
        description = """ì´ í”„ë¡œê·¸ë¨ì€ XES ë°ì´í„°ë² ì´ìŠ¤ ë¹„êµ ë° ê´€ë¦¬ë¥¼ ìœ„í•œ í”„ë¡œê·¸ë¨ì…ë‹ˆë‹¤.
        
ì£¼ìš” ê¸°ëŠ¥:
â€¢ ë‹¤ì¤‘ DB íŒŒì¼ ë¹„êµ ë¶„ì„
â€¢ ì°¨ì´ì  ìë™ ê°ì§€ ë° í•˜ì´ë¼ì´íŠ¸
â€¢ ìƒì„¸ ë¹„êµ ë³´ê³ ì„œ ìƒì„±
â€¢ ë°ì´í„° ì‹œê°í™” ë° í†µê³„ ë¶„ì„
â€¢ QC ìŠ¤í™ ê´€ë¦¬ ë° ê²€ì¦(ì¶”ê°€ ì˜ˆì •)
"""
        
        ttk.Label(desc_frame, text=description, style="Content.TLabel", 
                 wraplength=500, justify="left").pack(anchor="w")

    def show_about(self):
        # About ì°½ ìƒì„±
        about_window = tk.Toplevel(self.window)
        about_window.title("About")
        about_window.geometry("600x800")
        
        # ìŠ¤íƒ€ì¼ ì„¤ì •
        style = ttk.Style()
        style.configure("Title.TLabel", font=('Helvetica', 16, 'bold'))
        style.configure("Header.TLabel", font=('Helvetica', 12, 'bold'))
        style.configure("Content.TLabel", font=('Helvetica', 10))
        
        # ì»¨í…Œì´ë„ˆ í”„ë ˆì„
        container = ttk.Frame(about_window, padding="20")
        container.pack(expand=True, fill=tk.BOTH)
        
        # í”„ë¡œê·¸ë¨ ì œëª©
        title_frame = ttk.Frame(container)
        title_frame.pack(fill=tk.X, pady=(0, 20))
        ttk.Label(title_frame, text="DB ê´€ë¦¬ í”„ë¡œê·¸ë¨", style="Title.TLabel").pack()
        
        # ì •ë³´ ì„¹ì…˜ë“¤
        sections = [
            ("Product Information", [
                ("Version", "1.0.0"),
                ("Release Date", "2025-02-04"),
            ]),
            ("Development", [
                ("Developer", "Levi Beak / ë°±ê´‘ë¦¼"),
                ("Organization", "Quality Assurance Team"),
                ("Contact", "levi.beak@parksystems.com"),
            ]),
        ]
        
        for section_title, items in sections:
            # ì„¹ì…˜ í”„ë ˆì„
            section_frame = ttk.LabelFrame(container, text=section_title, padding="10")
            section_frame.pack(fill=tk.X, pady=(0, 10))
            
            # ê·¸ë¦¬ë“œ êµ¬ì„±
            for i, (key, value) in enumerate(items):
                ttk.Label(section_frame, text=key + ":", style="Header.TLabel").grid(
                    row=i, column=0, sticky="w", padx=(0, 10), pady=2)
                ttk.Label(section_frame, text=value, style="Content.TLabel").grid(
                    row=i, column=1, sticky="w", pady=2)
        
        # í”„ë¡œê·¸ë¨ ì„¤ëª…
        desc_frame = ttk.LabelFrame(container, text="Description", padding="10")
        desc_frame.pack(fill=tk.X, pady=(0, 10))
        
        description = """ì´ í”„ë¡œê·¸ë¨ì€ XES ë°ì´í„°ë² ì´ìŠ¤ ë¹„êµ ë° ê´€ë¦¬ë¥¼ ìœ„í•œ í”„ë¡œê·¸ë¨ì…ë‹ˆë‹¤.
        
ì£¼ìš” ê¸°ëŠ¥:
â€¢ ë‹¤ì¤‘ DB íŒŒì¼ ë¹„êµ ë¶„ì„
â€¢ ì°¨ì´ì  ìë™ ê°ì§€ ë° í•˜ì´ë¼ì´íŠ¸
â€¢ ìƒì„¸ ë¹„êµ ë³´ê³ ì„œ ìƒì„±
â€¢ ë°ì´í„° ì‹œê°í™” ë° í†µê³„ ë¶„ì„
â€¢ QC ìŠ¤í™ ê´€ë¦¬ ë° ê²€ì¦(ì¶”ê°€ ì˜ˆì •)
"""
        
        ttk.Label(desc_frame, text=description, style="Content.TLabel", 
                 wraplength=500, justify="left").pack(anchor="w")
        
        # ë¦¬ë¹„ì „ íˆìŠ¤í† ë¦¬ ë°ì´í„°
        revisions = [
            {
                "version": "1.0.0",
                "date": "2025-02-04",
                "summary": "ì´ˆê¸° ë²„ì „ ì¶œì‹œ",
                "details": {
                    "Features": [
                        "ë‹¤ì¤‘ XES DB íŒŒì¼ ë¹„êµ ë¶„ì„ ê¸°ëŠ¥",
                        "ìë™ ì°¨ì´ì  ê°ì§€ ë° í•˜ì´ë¼ì´íŠ¸",
                        "ìƒì„¸ ë¹„êµ ë³´ê³ ì„œ ìƒì„±"
                    ],
                    "Improvements": [
                        "ë°ì´í„° ì‹œê°í™” ë„êµ¬ ì¶”ê°€"
                    ],
                    "Bug Fixes": [
                        "íŒŒì¼ ë¡œë“œ ì‹œ ì¸ì½”ë”© ë¬¸ì œ ìˆ˜ì •",
                        "ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ìµœì í™”"
                    ]
                }
            }
            # ìƒˆë¡œìš´ ë²„ì „ì´ ì¶œì‹œë  ë•Œë§ˆë‹¤ ì—¬ê¸°ì— ì¶”ê°€
        ]
        
        # ë¦¬ë¹„ì „ íˆìŠ¤í† ë¦¬ë¥¼ ìœ„í•œ íŠ¸ë¦¬ë·° ìƒì„±
        revision_frame = ttk.LabelFrame(container, text="Revision History", padding="10")
        revision_frame.pack(fill=tk.X, pady=(0, 10))
        
        revision_tree = ttk.Treeview(revision_frame, height=6)
        revision_tree["columns"] = ("Version", "Date", "Summary")
        revision_tree.heading("#0", text="")
        revision_tree.column("#0", width=0, stretch=False)
        
        for col, width in [("Version", 70), ("Date", 100), ("Summary", 400)]:
            revision_tree.heading(col, text=col)
            revision_tree.column(col, width=width)
        
        # ë¦¬ë¹„ì „ ë°ì´í„° ì¶”ê°€
        for rev in revisions:
            revision_tree.insert("", 0, values=(
                rev["version"],
                rev["date"],
                rev["summary"]
            ), tags=("revision",))
        
        # ë”ë¸” í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
        def show_revision_details(event):
            item = revision_tree.selection()[0]
            version = revision_tree.item(item)["values"][0]
            
            # í•´ë‹¹ ë²„ì „ì˜ ìƒì„¸ ì •ë³´ ì°¾ê¸°
            rev_info = next(r for r in revisions if r["version"] == version)
            
            # ìƒì„¸ ì •ë³´ ì°½ ìƒì„±
            detail_window = tk.Toplevel(about_window)
            detail_window.title(f"Version {version} Details")
            detail_window.geometry("500x800")  # About ì°½ê³¼ ê°™ì€ ë†’ì´ë¡œ ì„¤ì •
            detail_window.transient(about_window)
            detail_window.grab_set()
            
            # About ì°½ ì˜¤ë¥¸ìª½ì— ë‚˜ë€íˆ í‘œì‹œ (í™”ë©´ ë²”ìœ„ ì²´í¬ ì¶”ê°€)
            about_x = about_window.winfo_x()
            about_y = about_window.winfo_y()
            about_width = about_window.winfo_width()
            
            # í™”ë©´ í¬ê¸° í™•ì¸
            screen_width = detail_window.winfo_screenwidth()
            
            # ìƒˆ ì°½ì˜ x ì¢Œí‘œ ê³„ì‚°
            new_x = about_x + about_width + 10
            
            # í™”ë©´ ë°–ìœ¼ë¡œ ë„˜ì–´ê°ˆ ê²½ìš° About ì°½ ì™¼ìª½ì— í‘œì‹œ
            if new_x + 500 > screen_width:  # 500ì€ detail_windowì˜ ë„ˆë¹„
                new_x = about_x - 510  # ì™¼ìª½ì— í‘œì‹œ (ê°„ê²© 10í”½ì…€)
            
            detail_window.geometry(f"500x800+{new_x}+{about_y}")
            
            # ìŠ¤íƒ€ì¼ ì„¤ì •
            style = ttk.Style()
            style.configure("Category.TLabel", font=('Helvetica', 11, 'bold'))
            style.configure("Item.TLabel", font=('Helvetica', 10))
            
            # ì»¨í…Œì´ë„ˆ ìƒì„±
            detail_container = ttk.Frame(detail_window, padding="20")
            detail_container.pack(fill=tk.BOTH, expand=True)
            
            # ë²„ì „ ì •ë³´ í—¤ë”
            ttk.Label(
                detail_container,
                text=f"Version {version} ({rev_info['date']})",
                style="Title.TLabel"
            ).pack(anchor="w", pady=(0, 20))
            
            # ì¹´í…Œê³ ë¦¬ë³„ ìƒì„¸ ì •ë³´ í‘œì‹œ
            for category, items in rev_info["details"].items():
                # ì¹´í…Œê³ ë¦¬ ì œëª©
                ttk.Label(
                    detail_container,
                    text=category,
                    style="Category.TLabel"
                ).pack(anchor="w", pady=(10, 5))
                
                # í•­ëª©ë“¤
                for item in items:
                    ttk.Label(
                        detail_container,
                        text=f"â€¢ {item}",
                        style="Item.TLabel",
                        wraplength=450
                    ).pack(anchor="w", padx=(20, 0))
            
            # ë‹«ê¸° ë²„íŠ¼
            ttk.Button(
                detail_container,
                text="ë‹«ê¸°",
                command=detail_window.destroy
            ).pack(pady=(20, 0))
        
        # ë”ë¸” í´ë¦­ ì´ë²¤íŠ¸ ë°”ì¸ë”©
        revision_tree.bind("<Double-1>", show_revision_details)
        
        # ìŠ¤í¬ë¡¤ë°” ì¶”ê°€
        scrollbar = ttk.Scrollbar(revision_frame, orient="vertical", command=revision_tree.yview)
        revision_tree.configure(yscrollcommand=scrollbar.set)
        
        # ë ˆì´ì•„ì›ƒ
        revision_tree.pack(side=tk.LEFT, fill=tk.BOTH, expand=True)
        scrollbar.pack(side=tk.RIGHT, fill=tk.Y)
        
        # ë‹«ê¸° ë²„íŠ¼
        ttk.Button(container, text="ë‹«ê¸°", command=about_window.destroy).pack(pady=(0, 10))

    def show_user_guide(self, event=None):
        print("ì‚¬ìš© ì„¤ëª…ì„œê°€ í˜¸ì¶œë˜ì—ˆìŠµë‹ˆë‹¤. (F1 í‚¤ ë˜ëŠ” ë©”ë‰´ ì„ íƒ)")
        guide_window = tk.Toplevel(self.window)
        guide_window.title("DB ê´€ë¦¬ ë„êµ¬ ì‚¬ìš© ì„¤ëª…ì„œ")
        guide_window.geometry("800x600")
        guide_window.resizable(True, True)  # ì°½ í¬ê¸° ì¡°ì ˆ ê°€ëŠ¥
        
        # ë¶€ëª¨ ì°½ ì¤‘ì•™ì— ìœ„ì¹˜
        x = self.window.winfo_x() + (self.window.winfo_width() // 2) - (800 // 2)
        y = self.window.winfo_y() + (self.window.winfo_height() // 2) - (600 // 2)
        guide_window.geometry(f"800x600+{x}+{y}")
        
        # ìŠ¤íƒ€ì¼ ì„¤ì •
        style = ttk.Style()
        style.configure("Title.TLabel", font=('Helvetica', 16, 'bold'))
        style.configure("Heading.TLabel", font=('Helvetica', 12, 'bold'))
        style.configure("Content.TLabel", font=('Helvetica', 10))
        
        # ë©”ì¸ í”„ë ˆì„ê³¼ ìº”ë²„ìŠ¤, ìŠ¤í¬ë¡¤ë°” ì„¤ì •
        main_frame = ttk.Frame(guide_window)
        main_frame.pack(fill=tk.BOTH, expand=True, padx=20, pady=20)
        
        canvas = tk.Canvas(main_frame)
        scrollbar = ttk.Scrollbar(main_frame, orient="vertical", command=canvas.yview)
        scrollable_frame = ttk.Frame(canvas)
        
        scrollable_frame.bind(
            "<Configure>",
            lambda e: canvas.configure(scrollregion=canvas.bbox("all"))
        )
        
        canvas.create_window((0, 0), window=scrollable_frame, anchor="nw")
        canvas.configure(yscrollcommand=scrollbar.set)
        
        # ë‚´ìš© êµ¬ì„±
        sections = [
            {
                "title": "ì‹œì‘í•˜ê¸°",
                "content": [
                    "1. í”„ë¡œê·¸ë¨ ì‹¤í–‰ í›„ 'íŒŒì¼' ë©”ë‰´ì—ì„œ 'í´ë” ì—´ê¸°' ì„ íƒ",
                    "2. DB Editorì—ì„œ Exportí•œ .txt íŒŒì¼ì´ ìˆëŠ” í´ë” ì„ íƒ",
                    "3. ìµœëŒ€ 6ê°œì˜ DB íŒŒì¼ë“¤ì„ ì„ íƒí•˜ì—¬ ë¹„êµ ë¶„ì„ ì‹¤í–‰"
                ]
            },
            {
                "title": "ì£¼ìš” ê¸°ëŠ¥",
                "content": [
                    "â€¢ DB íŒŒì¼ ë¹„êµ ë¶„ì„",
                    "  - ì—¬ëŸ¬ DB íŒŒì¼ì˜ ë‚´ìš©ì„ ìë™ìœ¼ë¡œ ë¹„êµ",
                    "  - ì°¨ì´ì  ìë™ ê°ì§€ ë° í•˜ì´ë¼ì´íŠ¸",
                    "  - ìƒì„¸ ë¹„êµ ê²°ê³¼ ì œê³µ",
                    "",
                    "â€¢ QC ê²€ìˆ˜ ê¸°ëŠ¥ (ì¶”ê°€ ì˜ˆì •)",
                    "  - ì„¤ì •ëœ ê¸°ì¤€ì— ë”°ë¥¸ ìë™ ê²€ì¦",
                    "  - ì˜¤ë¥˜ í•­ëª© ìë™ ê°ì§€",
                    "  - ê²€ìˆ˜ ê²°ê³¼ ë¦¬í¬íŠ¸ ìƒì„±"
                ]
            },
            {
                "title": "ë‹¨ì¶•í‚¤",
                "content": [
                    "â€¢ Ctrl + O : í´ë” ì—´ê¸°",
                    "â€¢ Ctrl + Q : í”„ë¡œê·¸ë¨ ì¢…ë£Œ",
                    "â€¢ F1 : ë„ì›€ë§ ì—´ê¸°"
                ]
            },
            {
                "title": "ìì£¼ ë¬»ëŠ” ì§ˆë¬¸",
                "content": [
                    "Q: ì§€ì›í•˜ëŠ” íŒŒì¼ í˜•ì‹ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                    "A: DB Editorì—ì„œ Exportí•œ .txt íŒŒì¼ì„ ì§€ì›í•©ë‹ˆë‹¤.",
                    "",
                    "Q: í•œ ë²ˆì— ëª‡ ê°œì˜ íŒŒì¼ì„ ë¹„êµí•  ìˆ˜ ìˆë‚˜ìš”?",
                    "A: ìµœëŒ€ 6ê°œì˜ íŒŒì¼ì„ ë™ì‹œì— ë¹„êµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
                    ""
                ]
            }
        ]
        
        # ì œëª©
        ttk.Label(
            scrollable_frame,
            text="DB ê´€ë¦¬ í”„ë¡œê·¸ë¨ ì‚¬ìš© ì„¤ëª…ì„œ",
            style="Title.TLabel"
        ).pack(pady=(0, 20))
        
        # ì„¹ì…˜ë³„ ë‚´ìš© ì¶”ê°€
        for section in sections:
            # ì„¹ì…˜ ì œëª©
            ttk.Label(
                scrollable_frame,
                text=section["title"],
                style="Heading.TLabel"
            ).pack(anchor="w", pady=(15, 5))
            
            # ì„¹ì…˜ ë‚´ìš©
            for line in section["content"]:
                ttk.Label(
                    scrollable_frame,
                    text=line,
                    style="Content.TLabel",
                    wraplength=700,
                    justify="left"
                ).pack(anchor="w", padx=(20, 0))
        
        # ë ˆì´ì•„ì›ƒ ì„¤ì •
        canvas.pack(side="left", fill="both", expand=True)
        scrollbar.pack(side="right", fill="y")

    def update_log(self, message):
        if hasattr(self, 'log_text'):
            self.log_text.insert("end", message + "\n")
            self.log_text.see("end")

class LoadingDialog:
    def __init__(self, parent):
        self.top = tk.Toplevel(parent)
        self.top.title("ë¡œë”© ì¤‘...")
        
        # ë¶€ëª¨ ì°½ ì¤‘ì•™ì— ìœ„ì¹˜
        window_width = 300
        window_height = 100
        screen_width = parent.winfo_screenwidth()
        screen_height = parent.winfo_screenheight()
        x = (screen_width - window_width) // 2
        y = (screen_height - window_height) // 2
        self.top.geometry(f'{window_width}x{window_height}+{x}+{y}')
        
        # í•­ìƒ ìµœìƒìœ„ì— í‘œì‹œ
        self.top.transient(parent)
        self.top.grab_set()
        
        # ì§„í–‰ ìƒíƒœ í‘œì‹œ
        self.progress_var = tk.DoubleVar()
        self.progress = ttk.Progressbar(
            self.top, 
            variable=self.progress_var,
            maximum=100,
            mode='determinate',
            length=200
        )
        self.progress.pack(pady=10)
        
        # í˜„ì¬ ì‘ì—… ì„¤ëª…
        self.status_label = ttk.Label(self.top, text="íŒŒì¼ ë¡œë”© ì¤‘...")
        self.status_label.pack(pady=5)
        
        # ì§„í–‰ë¥  í…ìŠ¤íŠ¸
        self.percentage_label = ttk.Label(self.top, text="0%")
        self.percentage_label.pack(pady=5)
        
        # ì°½ ë‹«ê¸° ë²„íŠ¼ ë¹„í™œì„±í™”
        self.top.protocol("WM_DELETE_WINDOW", lambda: None)
        
    def update_progress(self, value, status_text=None):
        self.progress_var.set(value)
        self.percentage_label.config(text=f"{int(value)}%")
        if status_text:
            self.status_label.config(text=status_text)
        self.top.update()
    
    def close(self):
        self.top.grab_release()
        self.top.destroy()

def main():
    app = DBManager()
    app.window.mainloop()

if __name__ == "__main__":
    main() 